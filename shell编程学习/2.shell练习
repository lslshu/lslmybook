#！bin/bash
#备份数据库和目录
menu()
{
	clear
	cat <<EOF
	   #这是一个菜单
	   1.备份数据库
	   2.还原数据库
	   3.备份文件
	   4.还原文件
	   5.退出脚本
EOF
read -p "请输入数字[1-5]:" list
case $list in
	1)
		mysql_backup
	;;
	2)
        mysql_restore
    ;;
	3)
        file_restore
    ;;
    4)
        file_restore
    ;;    
    5)
        echo "退出中..."
        sleep 2
        exit 0
    ;;
esac
}

mysql_backup()
{
	cat<<EOF
	###############备份数据库菜单#############
	##默认文件位置/data/backup
	##如果想要更改，请自行修改
	##为了安全需自行输入密码，可使用expect
	##压缩备份myname|gzip  .sql.gz
	1.########   备份整个数据库   ############
	2.########   备份单个数据库   ############
	3.##########     退出      ############
EOF
[ !-d /data/backup ] && mkdir -p /data/bakcup 
read -p "请输入数字[1-3]：" myback
if [[ "$myback" -eq 1 ]]; then
	mysqldump -uroot -p --all-databases >/data/backup/testbak_$(date +%F).sql
	echo "备份全部数据库中..."
	sleep 2
	exit 2
elif [[ "$myback" -eq 2 ]]; then
	read -p "备份数据库名:" myname
	mysqldump -uroot -p "$myname" >/data/backup/testbak_$(date +%F).sql
	echo "备份中....."
	sleep 2
	exit 2
elif [[ "$myback" -eq 3 ]]; then
	echo "退出脚本"
	break
fi
}
mysql_restore()
{
	cat<<EOF
	###############还原数据库菜单#############
	##还原数据库需要进入数据库创建相同数据库
	1.########   还原整个数据库   ############
	2.########   还原单个数据库   ############
	3.##########     退出      ############
EOF
read -p "请输入数字[1-3]：" myres
if [[ "$myres" -eq 1 ]]; then
	read -p "备份数据库名:" myname
	mysql -uroot -p --all-databases<
	echo "还原全部数据库中..."
	sleep 2
	exit 2
elif [[ "$myres" -eq 2 ]]; then
	read -p "备份数据库名:" myname
	mysqldump -uroot -p "$myname" >/data/backup/testbak_$(date +%F).sql
	echo "还原单个数据库中....."
	sleep 2
	exit 2
elif [[ "$myres" -eq 3 ]]; then
	echo "退出脚本"
	break
fi
}

#运行函数
while :
do
	menu
done